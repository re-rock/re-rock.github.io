---
title: Lifecycle
---

## Application Life Cycle

### 1. Instantiation

最初に、`\Slim\App`クラスをインスタンス化します。これは、Slimアプリケーションオブジェクトです。
インスタンス化する際に、Slimはアプリケーションの各依存関係をデフォルトのサービスに登録します。アプリケーションコンストラクターは、アプリケーションの動作を構成するオプション設定の配列を受け入れます。

### 2. Route Definitions

次に、アプリケーションインスタンスの`get()`、`post()`、`put()`、`delete()`、`patch()`、`head()`、`options()`などのルーティングメソッドを使用してルートを定義します。これらのインスタンスメソッドは、アプリケーションのルーターオブジェクトにルートを登録します。各ルーティングメソッドはRouteインスタンスを返すので、すぐにRouteインスタンスのメソッドを呼び出してミドルウェアを追加したり、名前を割り当てたりできます。

### 3. Application Runner

3番目に、アプリケーションインスタンスの`run()`メソッドを呼び出します。このメソッドは、次のプロセスを開始します。

#### A. Enter Middleware Stack

`run()`メソッドを呼ぶとは、アプリケーションのミドルウェアスタック内を走査し始めます。これは、Slimアプリケーションの実行前（および実行後）にEnvironment、Request、およびResponseオブジェクトを受け取る（およびオプションで操作する）ミドルウェアレイヤーの集中管理構造です。
Slimアプリケーションは、集中管理ミドルウェア構造のもっとも内側の層です。各ミドルウェアレイヤーは、もっとも外側のレイヤーから内側に向​​かって呼び出されます。

#### B. Run Application

`run()`メソッドは、もっとも内側のミドルウェアレイヤーに到達すると、アプリケーションインスタンスを呼び出し、保有するHTTPリクエストを適切なアプリケーションルートオブジェクトに送り出します。ルートがHTTPメソッドとURIに一致すると、ルートのミドルウェアと呼び出し先のオブジェクトが呼ばれます。一致するルートが見つからない場合、Not FoundまたはNot Allowedハンドラーが呼び出されます。

#### C. Exit Middleware Stack

アプリケーションのディスパッチプロセスが完了すると、各ミドルウェアレイヤーは、最も内側のレイヤーから外側に向かって制御を回収します。

#### D. Send HTTP Response

最外部のミドルウェアレイヤーが制御を開放したあと、アプリケーションインスタンスはHTTPレスポンスを準備し、シリアル化を行ったあと返却します。 
HTTPレスポンスヘッダーはPHPのネイティブ`header()`メソッドで設定され、HTTPレスポンスボディは実行中のアウトプットバッファーに出力されます。

